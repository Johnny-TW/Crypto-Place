#!/bin/sh
set -e

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only)

# Check if any relevant files are staged
FRONTEND_FILES=$(echo "$STAGED_FILES" | grep -E "^frontend/" || true)
BACKEND_FILES=$(echo "$STAGED_FILES" | grep -E "^backend/" || true)

# Only run frontend lint-staged if frontend files are staged
if [ -n "$FRONTEND_FILES" ]; then
    echo "üì¶ Frontend files detected, running lint-staged..."
    cd frontend && pnpm lint-staged
    cd ..
fi

# Only run backend lint-staged if backend files are staged  
if [ -n "$BACKEND_FILES" ]; then
    echo "‚öôÔ∏è Backend files detected, running lint-staged..."
    cd backend && pnpm lint-staged
    cd ..
fi

# If no relevant files staged, skip checks
if [ -z "$FRONTEND_FILES" ] && [ -z "$BACKEND_FILES" ]; then
    echo "‚è≠Ô∏è No frontend or backend files staged, skipping checks"
    exit 0
fi

echo "‚úÖ All checks passed successfully!"